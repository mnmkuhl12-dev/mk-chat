<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>M & K Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background: #111;
      color: white;
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 0;
      padding: 20px;
    }
    input, button {
      padding: 10px;
      margin: 5px;
      font-size: 16px;
    }
    #messages {
      height: 300px;
      overflow-y: auto;
      border: 1px solid #444;
      padding: 10px;
      margin-bottom: 10px;
      text-align: left;
    }
    .hidden { display: none; }
  </style>
</head>
<body>

  <!-- PASSWORD SCREEN -->
  <div id="login">
    <h2>Enter Password</h2>
    <input id="pass" type="password" placeholder="Password">
    <br>
    <button onclick="login()">Enter</button>
  </div>

  <!-- USER SELECT SCREEN -->
  <div id="choose" class="hidden">
    <h2>Who are you?</h2>
    <button onclick="setUser('M')">M</button>
    <button onclick="setUser('K')">K</button>
  </div>

  <!-- CHAT SCREEN -->
  <div id="chat" class="hidden">
    <h2>M & K Chat</h2>
    <div id="messages"></div>
    <input id="msg" placeholder="Type a message" onkeydown="if(event.key==='Enter') sendMessage()">
  </div>

<script type="module">
  // --- FIREBASE CDN IMPORT ---
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // --- FIREBASE CONFIG --- 
  const firebaseConfig = {
    apiKey: "AIzaSyBT7sj4JDmLXuJzyZVe3wQx9nqqdrXgUB0",
    authDomain: "mk-chat-f9a10.firebaseapp.com",
    projectId: "mk-chat-f9a10",
    storageBucket: "mk-chat-f9a10.firebasestorage.app",
    messagingSenderId: "609608804648",
    appId: "1:609608804648:web:79e5aae8f3a5851b4cc81d"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // --- ELEMENTS ---
  const loginDiv = document.getElementById("login");
  const chooseDiv = document.getElementById("choose");
  const chatDiv = document.getElementById("chat");
  const passInput = document.getElementById("pass");
  const messagesDiv = document.getElementById("messages");
  const msgInput = document.getElementById("msg");

  const PASSWORD = "1234"; // Change as needed
  let user = "";
  let otherUser = "";

  // --- LOGIN ---
  window.login = function() {
    if (passInput.value === PASSWORD) {
      loginDiv.classList.add("hidden");
      chooseDiv.classList.remove("hidden");
    } else {
      alert("Wrong password");
    }
  };

  // --- SET M/K ---
  window.setUser = function(u) {
    user = u;
    otherUser = u === "M" ? "K" : "M";  // The other person
    chooseDiv.classList.add("hidden");
    chatDiv.classList.remove("hidden");
    startListening();
  };

  // --- SEND MESSAGE ---
  window.sendMessage = async function() {
    if (!msgInput.value.trim()) return;

    await addDoc(collection(db, "messages"), {
      user: user,
      text: msgInput.value,
      time: Date.now()
    });

    msgInput.value = "";
  };

  // --- LISTEN TO M/K MESSAGES ONLY ---
  function startListening() {
    const q = query(collection(db, "messages"), orderBy("time"));
    onSnapshot(q, snapshot => {
      messagesDiv.innerHTML = "";
      snapshot.forEach(doc => {
        const data = doc.data();
        // Only show messages from M or K
        if(data.user === user || data.user === otherUser) {
          messagesDiv.innerHTML += `<div><b>${data.user}:</b> ${data.text}</div>`;
        }
      });
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    });
  }
</script>

</body>
</html>
